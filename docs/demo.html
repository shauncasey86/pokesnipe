<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokéSnipe Pro | Arbitrage Terminal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config={darkMode:'class',theme:{extend:{fontFamily:{sans:['Inter','sans-serif'],mono:['JetBrains Mono','monospace']},colors:{obsidian:'#0B0C10',surface:'#12141A',surfaceHover:'#1A1D24',border:'#23262F',brand:'#6366F1',profit:'#10B981',risk:'#EF4444',warn:'#F59E0B',info:'#60A5FA',muted:'#8B92A5',grail:'#FFB020'}}}}
    </script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body{background:#0B0C10;color:#E2E8F0;overflow:hidden;margin:0}
        *{box-sizing:border-box}
        ::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#23262F;border-radius:10px}
        .glass-panel{background:rgba(18,20,26,.7);backdrop-filter:blur(12px);border-bottom:1px solid rgba(255,255,255,.05)}
        .image-glow{box-shadow:0 0 40px rgba(99,102,241,.15)}
        .conf-ring{transform:rotate(-90deg)}
        .tier-GRAIL{background:linear-gradient(135deg,#FFB020,#ff6b2b);color:#0B0C10}
        .tier-HIT{background:rgba(16,185,129,.12);color:#10B981;border:1px solid rgba(16,185,129,.2)}
        .tier-FLIP{background:rgba(96,165,250,.12);color:#60A5FA;border:1px solid rgba(96,165,250,.2)}
        .tier-SLEEP{background:rgba(139,146,165,.1);color:#8B92A5}
        @keyframes pd{0%,100%{box-shadow:0 0 4px #10B981}50%{box-shadow:0 0 12px #10B981}}
        .pulse-dot{animation:pd 2.5s ease-in-out infinite}
        @keyframes scan-pulse{0%{opacity:.4}50%{opacity:1}100%{opacity:.4}}
        .scan-anim{animation:scan-pulse 1.5s ease-in-out infinite}
        .deal-row:focus-visible{outline:2px solid #6366F1;outline-offset:-2px;border-radius:12px}
        .deal-stale{opacity:.45;filter:grayscale(.35)}
        @keyframes spin{to{transform:rotate(360deg)}}.spinner{animation:spin .8s linear infinite}
        .exp-logo{width:20px;height:20px;object-fit:contain;image-rendering:auto}
    </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useMemo,useRef,useCallback}=React;

// Icons
const I={
Crosshair:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="22" y1="12" x2="18" y2="12"/><line x1="6" y1="12" x2="2" y2="12"/><line x1="12" y1="6" x2="12" y2="2"/><line x1="12" y1="22" x2="12" y2="18"/></svg>,
Radar:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19.07 4.93A10 10 0 0 0 6.99 3.34"/><circle cx="12" cy="12" r="2"/><path d="m13.41 10.59 5.66-5.66"/></svg>,
Search:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
Filter:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="21" x2="14" y1="4" y2="4"/><line x1="10" x2="3" y1="4" y2="4"/><line x1="14" x2="14" y1="2" y2="6"/></svg>,
Settings:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/></svg>,
FileSearch:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><circle cx="11.5" cy="14.5" r="2.5"/><path d="M13.3 16.3 15 18"/></svg>,
Server:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="8" x="2" y="2" rx="2"/><rect width="20" height="8" x="2" y="14" rx="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg>,
ScrollText:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4"/><path d="M19 17V5a2 2 0 0 0-2-2H4"/></svg>,
User:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
Clock:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
ExtLink:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg>,
Bell:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>,
Up:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z"/></svg>,
Down:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 14V2"/><path d="M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z"/></svg>,
Check:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 6 9 17l-5-5"/></svg>,
X:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
ChevronDown:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6 9 6 6 6-6"/></svg>,
Send:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>,
AlertTriangle:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>,
Activity:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>,
Database:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/></svg>,
Zap:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M13 2 3 14h9l-1 10 10-12h-9l1-10z"/></svg>,
Eye:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>,
EyeOff:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"/><line x1="2" x2="22" y1="2" y2="22"/></svg>,
Globe:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>,
Key:({s=20,c=""})=><svg className={c} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="7.5" cy="15.5" r="5.5"/><path d="m21 2-9.3 9.3"/><path d="m18 5 3-3"/></svg>,
Loader:({s=20,c=""})=><svg className={`spinner ${c}`} width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>,
};

// ═══════════ MOCK DATA ═══════════
// Expansion data (§9 expansions table)
const EXPANSIONS={
  EVS:{name:'Evolving Skies',code:'EVS',series:'Sword & Shield',printedTotal:203,total:237,releaseDate:'2021-08-27',logo:'https://images.pokemontcg.io/swsh7/logo.png',symbol:'https://images.pokemontcg.io/swsh7/symbol.png'},
  CPA:{name:"Champion's Path",code:'CPA',series:'Sword & Shield',printedTotal:73,total:80,releaseDate:'2020-09-25',logo:'https://images.pokemontcg.io/swsh35/logo.png',symbol:'https://images.pokemontcg.io/swsh35/symbol.png'},
  SIT:{name:'Silver Tempest',code:'SIT',series:'Sword & Shield',printedTotal:195,total:215,releaseDate:'2022-11-11',logo:'https://images.pokemontcg.io/swsh12/logo.png',symbol:'https://images.pokemontcg.io/swsh12/symbol.png'},
  LOR:{name:'Lost Origin',code:'LOR',series:'Sword & Shield',printedTotal:196,total:217,releaseDate:'2022-09-09',logo:'https://images.pokemontcg.io/swsh11/logo.png',symbol:'https://images.pokemontcg.io/swsh11/symbol.png'},
};

const DEALS=[
  {id:'d1',ebayItemId:'384729105',name:'Umbreon VMAX (Alternate Art)',set:{name:'Evolving Skies',code:'EVS'},num:'215/203',variant:'holofoil',cond:'NM',condSrc:'conditionDescriptors',isGr:true,grader:'PSA',grade:'10',scrImg:'https://images.pokemontcg.io/swsh7/215_hires.png',ebImg:'https://i.ebayimg.com/images/g/U~4AAOSwVENm2Xqx/s-l1600.jpg',rarity:'Secret Rare',eP:142.00,ship:4.99,bp:6.34,tCost:153.33,mGBP:209.09,fx:0.789,pGBP:55.76,pPct:36.4,tier:'HIT',conf:0.92,confT:'high',liq:0.81,liqG:'high',trends:{'1d':0.8,'7d':2.4,'30d':5.1,'90d':12.3},seller:'poke_vault_99',fb:12847,comps:{NM:{lo:189,mk:209},LP:{lo:142,mk:166},MP:{lo:95,mk:122},HP:null},url:'https://www.ebay.co.uk/itm/384729105',at:new Date(Date.now()-2*60000),status:'active',reviewedAs:null,
    confSignals:{name:0.95,denominator:0.92,number:1.0,expansion:0.88,variant:0.85,normalization:0.90},
    liqSignals:{trend:0.75,prices:1.0,spread:0.88,supply:0.80,sold:0.67,velocity:0.85},hasVelocity:true},
  {id:'d2',ebayItemId:'293847165',name:'Charizard V',set:{name:"Champion's Path",code:'CPA'},num:'079/073',variant:'normal',cond:'NM',condSrc:'title',isGr:false,grader:null,grade:null,scrImg:'https://images.pokemontcg.io/swsh35/79_hires.png',ebImg:'https://i.ebayimg.com/images/g/iMQAAOSwITdm4Rfk/s-l1600.jpg',rarity:'Ultra Rare',eP:18.50,ship:2.99,bp:1.50,tCost:22.99,mGBP:33.14,fx:0.789,pGBP:10.15,pPct:44.1,tier:'GRAIL',conf:0.88,confT:'high',liq:0.83,liqG:'high',trends:{'1d':-0.3,'7d':1.2,'30d':3.8,'90d':8.7},seller:'tcg_king_uk',fb:3421,comps:{NM:{lo:30,mk:33},LP:{lo:22,mk:27},MP:{lo:14,mk:19},HP:{lo:8,mk:11}},url:'https://www.ebay.co.uk/itm/293847165',at:new Date(Date.now()-5*60000),status:'active',reviewedAs:null,
    confSignals:{name:0.88,denominator:1.0,number:1.0,expansion:0.92,variant:0.78,normalization:0.82},
    liqSignals:{trend:0.50,prices:1.0,spread:0.91,supply:1.0,sold:1.0,velocity:0.70},hasVelocity:true},
  {id:'d3',ebayItemId:'401928374',name:'Lugia V (Alternate Art)',set:{name:'Silver Tempest',code:'SIT'},num:'186/195',variant:'holofoil',cond:'LP',condSrc:'conditionDescriptors',isGr:false,grader:null,grade:null,scrImg:'https://images.pokemontcg.io/swsh12/186_hires.png',ebImg:'https://i.ebayimg.com/images/g/mSIAAOSwA~Fm5Yrd/s-l1600.jpg',rarity:'Ultra Rare',eP:22.00,ship:3.50,bp:1.58,tCost:27.08,mGBP:35.11,fx:0.789,pGBP:8.03,pPct:29.7,tier:'HIT',conf:0.78,confT:'medium',liq:0.62,liqG:'medium',trends:{'1d':0.0,'7d':1.5,'30d':4.2,'90d':9.1},seller:'card_baron_uk',fb:856,comps:{NM:{lo:32,mk:38},LP:{lo:25,mk:35},MP:{lo:17,mk:24},HP:null},url:'https://www.ebay.co.uk/itm/401928374',at:new Date(Date.now()-12*60000),status:'active',reviewedAs:'correct',
    confSignals:{name:0.75,denominator:0.82,number:1.0,expansion:0.78,variant:0.68,normalization:0.72},
    liqSignals:{trend:0.50,prices:0.75,spread:0.72,supply:0.40,sold:0.33,velocity:0.50},hasVelocity:false},
  {id:'d4',ebayItemId:'510293847',name:'Giratina V (Alternate Art)',set:{name:'Lost Origin',code:'LOR'},num:'186/196',variant:'holofoil',cond:'NM',condSrc:'conditionDescriptors',isGr:true,grader:'CGC',grade:'9.5',scrImg:'https://images.pokemontcg.io/swsh11/186_hires.png',ebImg:'https://i.ebayimg.com/images/g/fakAAOSwxxxxfake1/s-l1600.jpg',rarity:'Ultra Rare',eP:68.00,ship:0,bp:3.32,tCost:71.32,mGBP:90.74,fx:0.789,pGBP:19.42,pPct:27.2,tier:'HIT',conf:0.91,confT:'high',liq:0.74,liqG:'medium',trends:{'1d':0.5,'7d':2.1,'30d':6.8,'90d':15.2},seller:'japan_imports_uk',fb:5612,comps:{NM:{lo:83,mk:91},LP:{lo:63,mk:75},MP:{lo:43,mk:55},HP:null},url:'https://www.ebay.co.uk/itm/510293847',at:new Date(Date.now()-18*60000),status:'expired',reviewedAs:null,
    confSignals:{name:0.93,denominator:0.90,number:1.0,expansion:0.90,variant:0.82,normalization:0.88},
    liqSignals:{trend:0.75,prices:0.75,spread:0.78,supply:0.60,sold:0.67,velocity:0.85},hasVelocity:true},
  {id:'d5',ebayItemId:'620384756',name:'Rayquaza VMAX (Alt Art)',set:{name:'Evolving Skies',code:'EVS'},num:'218/203',variant:'holofoil',cond:'MP',condSrc:'title',isGr:false,grader:null,grade:null,scrImg:'https://images.pokemontcg.io/swsh7/218_hires.png',ebImg:'https://i.ebayimg.com/images/g/fakAAOSwxxxxfake2/s-l1600.jpg',rarity:'Secret Rare',eP:45.00,ship:5.99,bp:2.48,tCost:53.47,mGBP:64.70,fx:0.789,pGBP:11.23,pPct:21.0,tier:'FLIP',conf:0.71,confT:'medium',liq:0.55,liqG:'medium',trends:{'1d':-1.2,'7d':-0.8,'30d':3.4,'90d':11.0},seller:'elite_collectors_gb',fb:421,comps:{NM:{lo:87,mk:103},LP:{lo:67,mk:83},MP:{lo:49,mk:65},HP:{lo:32,mk:43}},url:'https://www.ebay.co.uk/itm/620384756',at:new Date(Date.now()-65*60000),status:'sold',reviewedAs:'incorrect',
    confSignals:{name:0.68,denominator:0.75,number:1.0,expansion:0.72,variant:0.55,normalization:0.62},
    liqSignals:{trend:0.25,prices:1.0,spread:0.65,supply:0.40,sold:0.33,velocity:0.50},hasVelocity:false},
];

// Mock audit log entries (same as before)
const AUDIT_LOG=[
  {id:1,ts:new Date(Date.now()-1*60000),level:'info',service:'scanner',msg:'Deal created',ctx:{dealId:'d1',card:'Umbreon VMAX',tier:'HIT',profit:'\u00a355.76',conf:'92%'}},
  {id:2,ts:new Date(Date.now()-1.5*60000),level:'info',service:'matcher',msg:'Card matched \u2014 number_first',ctx:{ebayTitle:'PSA 10 Umbreon VMAX 215/203 Alt Art',candidate:'Umbreon VMAX (Alternate Art)',conf:0.92}},
  {id:3,ts:new Date(Date.now()-2*60000),level:'info',service:'scanner',msg:'Listing enriched via getItem',ctx:{ebayItemId:'384729105',seller:'poke_vault_99',condition:'NM'}},
  {id:4,ts:new Date(Date.now()-3*60000),level:'warn',service:'scanner',msg:'Low confidence \u2014 logged for training only',ctx:{ebayTitle:'Pokemon card bundle lot 50x',conf:0.31,reason:'Below 0.45 threshold'}},
  {id:5,ts:new Date(Date.now()-4*60000),level:'info',service:'scanner',msg:'Deal created',ctx:{dealId:'d2',card:'Charizard V',tier:'GRAIL',profit:'\u00a310.15',conf:'88%'}},
  {id:6,ts:new Date(Date.now()-5*60000),level:'info',service:'pricing',msg:'Buyer protection fee calculated',ctx:{subtotal:'\u00a321.49',fee:'\u00a31.50',formula:'\u00a30.10 + 7%\u00d7\u00a320 + 4%\u00d7\u00a31.49'}},
  {id:7,ts:new Date(Date.now()-8*60000),level:'warn',service:'ebay',msg:'Rate limit approaching \u2014 429 count: 2',ctx:{callsRemain:312,dailyBudget:5000}},
  {id:8,ts:new Date(Date.now()-10*60000),level:'info',service:'sync',msg:'Delta sync completed',ctx:{expansions:3,cardsUpserted:847,variantsUpserted:2104,credits:420}},
  {id:9,ts:new Date(Date.now()-15*60000),level:'error',service:'exchange',msg:'Exchange rate fetch failed \u2014 using cached',ctx:{lastFetch:'47m ago',cachedRate:0.789,error:'ETIMEDOUT'}},
  {id:10,ts:new Date(Date.now()-20*60000),level:'info',service:'scanner',msg:'Scan cycle completed',ctx:{searched:48,processed:12,matched:5,rejected:7,deals:2,elapsed:'14.2s'}},
  {id:11,ts:new Date(Date.now()-30*60000),level:'info',service:'matcher',msg:'Card matched \u2014 number_first',ctx:{ebayTitle:'Lugia V Alt Art 186/195 Silver Tempest',candidate:'Lugia V (Alternate Art)',conf:0.78}},
  {id:12,ts:new Date(Date.now()-45*60000),level:'info',service:'cleanup',msg:'Deal expired',ctx:{dealId:'d4',reason:'72h TTL exceeded',originalTier:'HIT'}},
  {id:13,ts:new Date(Date.now()-50*60000),level:'warn',service:'scanner',msg:'eBay listing ended \u2014 marking deal as sold',ctx:{dealId:'d5',ebayItemId:'620384756',ebayStatus:'EndedWithSales'}},
  {id:14,ts:new Date(Date.now()-90*60000),level:'info',service:'review',msg:'Match marked incorrect by user',ctx:{dealId:'d5',card:'Rayquaza VMAX',reason:'Wrong variant'}},
  {id:15,ts:new Date(Date.now()-120*60000),level:'info',service:'sync',msg:'Full sync started',ctx:{type:'weekly',trigger:'cron'}},
];
const SYNC_LOG=[
  {id:1,type:'delta',startedAt:new Date(Date.now()-10*60000),completedAt:new Date(Date.now()-9.5*60000),status:'completed',expansions:3,cards:847,variants:2104,credits:420},
  {id:2,type:'delta',startedAt:new Date(Date.now()-130*60000),completedAt:new Date(Date.now()-129*60000),status:'completed',expansions:2,cards:312,variants:801,credits:180},
  {id:3,type:'full',startedAt:new Date(Date.now()-48*3600000),completedAt:new Date(Date.now()-47.2*3600000),status:'completed',expansions:347,cards:18420,variants:52800,credits:14200},
];

const TIER_CFG={GRAIL:{l:'Chase-tier',d:'Profit >40% + high liquidity'},HIT:{l:'Solid hit',d:'Profit 25\u201340%'},FLIP:{l:'Quick flip',d:'Profit 15\u201325%'},SLEEP:{l:'Sleeper',d:'<15% or low liquidity'}};
const CONF_WEIGHTS={name:0.30,denominator:0.25,number:0.15,expansion:0.10,variant:0.10,normalization:0.10};
const LIQ_WEIGHTS_V={trend:0.15,prices:0.10,spread:0.10,supply:0.15,sold:0.10,velocity:0.40};
const LIQ_WEIGHTS_NV={trend:0.25,prices:0.15,spread:0.15,supply:0.25,sold:0.20,velocity:0.00};
function timeAgo(d){const s=Math.floor((Date.now()-d)/1000);if(s<60)return s+'s ago';if(s<3600)return Math.floor(s/60)+'m ago';if(s<86400)return Math.floor(s/3600)+'h ago';return Math.floor(s/86400)+'d ago'}
function fmtTime(d){return d.toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit',second:'2-digit'})}
function fmtListedTime(d){const now=new Date();const diffMin=Math.floor((now-d)/60000);if(diffMin<60)return fmtTime(d);return d.toLocaleDateString('en-GB',{day:'numeric',month:'short'})+' '+fmtTime(d)}
function trendInfo(v){if(v>.5)return{t:'\u25b2 +'+v.toFixed(1)+'%',c:'text-profit'};if(v<-.5)return{t:'\u25bc '+v.toFixed(1)+'%',c:'text-risk'};return{t:'\u2014 '+v.toFixed(1)+'%',c:'text-muted'}}
function bestImg(d,wantScr){if(wantScr)return d.scrImg;return d.ebImg.includes('fake')?d.scrImg:d.ebImg}
function hasEbImg(d){return !d.ebImg.includes('fake')}

// Shared components
const Ring=({v,tier,sz=36})=>{const r=sz/2-4,ci=2*Math.PI*r,da=(v/100)*ci,co=tier==='high'?'#10B981':tier==='medium'?'#F59E0B':'#EF4444';return(
<div className="relative shrink-0" style={{width:sz,height:sz}} title={'Confidence: '+v+'%'}>
<svg className="conf-ring" width={sz} height={sz} viewBox={'0 0 '+sz+' '+sz}><circle cx={sz/2} cy={sz/2} r={r} fill="none" stroke="#23262F" strokeWidth="2.5"/><circle cx={sz/2} cy={sz/2} r={r} fill="none" stroke={co} strokeWidth="2.5" strokeLinecap="round" strokeDasharray={da+' '+ci}/></svg>
<span className="absolute inset-0 flex items-center justify-center font-mono text-[9px] font-bold text-white/80">{v}</span>
</div>)};
const Tier=({t})=><span className={'tier-'+t+' text-[9px] font-mono font-bold px-2 py-0.5 rounded tracking-wider'} title={TIER_CFG[t]?.d}>{t}</span>;
const SideItem=({icon:Ic,label,active,badge,onClick})=>(<button onClick={onClick} className={'w-full flex items-center justify-between px-4 py-3 rounded-xl transition-all '+(active?'bg-brand/10 text-brand':'text-muted hover:text-white hover:bg-surfaceHover')}><div className="flex items-center gap-3"><Ic s={20} c={active?'stroke-[2.5px]':'stroke-2'}/><span className="font-medium text-sm">{label}</span></div>{badge!=null&&<span className={'text-[10px] font-bold px-2 py-0.5 rounded-full '+(active?'bg-brand text-white':'bg-surface border border-border text-muted')}>{badge}</span>}</button>);
const Stat=({label,value})=>(<div className="flex flex-col border-r border-border last:border-0 px-6"><span className="text-[9px] font-medium text-muted uppercase tracking-wider mb-1">{label}</span><span className="text-lg font-bold text-white font-mono">{value}</span></div>);
const EmptyFeed=({hasFilter})=>(<div className="flex-1 flex items-center justify-center"><div className="text-center max-w-xs">{hasFilter?<><I.Search s={40} c="text-muted/30 mx-auto mb-3"/><h3 className="text-base font-bold text-white mb-1">No matches</h3><p className="text-xs text-muted">No deals match your current filters. Try broadening your search or enabling more tiers.</p></>:<><div className="relative mx-auto mb-4 w-12 h-12"><I.Radar s={48} c="text-brand/40 scan-anim"/></div><h3 className="text-base font-bold text-white mb-1">Scanning eBay\u2026</h3><p className="text-xs text-muted">New deals will appear here as they're found.</p></>}</div></div>);
const MetricCard=({icon:Ic,label,value,sub,color='text-white',border='border-border'})=>(<div className={'bg-obsidian border '+border+' rounded-xl p-4'}><div className="flex items-center gap-2 mb-2"><Ic s={14} c="text-muted"/><span className="text-[9px] font-bold text-muted uppercase tracking-wider">{label}</span></div><div className={'text-2xl font-mono font-bold '+color}>{value}</div>{sub&&<div className="text-[10px] text-muted mt-1">{sub}</div>}</div>);
const Progress=({value,max,color='bg-profit',warn,label})=>{const pct=Math.min((value/max)*100,100);const isWarn=warn&&pct>warn;return(<div>{label&&<div className="flex justify-between text-[10px] mb-1.5"><span className="text-muted">{label}</span><span className="font-mono text-white/70">{value.toLocaleString()} / {max.toLocaleString()}</span></div>}<div className="w-full bg-obsidian rounded-full h-2 overflow-hidden"><div className={'h-2 rounded-full transition-all '+(isWarn?'bg-warn':color)} style={{width:pct+'%'}}/></div></div>)};
const StatusDot=({ok})=><div className={'w-2.5 h-2.5 rounded-full '+(ok?'bg-profit pulse-dot':'bg-risk')}/>;

// Mini ring for signal breakdowns - matches the Ring component style
const MiniRing=({v,sz=28})=>{const r=sz/2-3,ci=2*Math.PI*r,da=(v/100)*ci,co=v>=80?'#10B981':v>=60?'#F59E0B':'#EF4444';return(
<div className="relative shrink-0" style={{width:sz,height:sz}}>
<svg className="conf-ring" width={sz} height={sz} viewBox={'0 0 '+sz+' '+sz}><circle cx={sz/2} cy={sz/2} r={r} fill="none" stroke="#23262F" strokeWidth="2"/><circle cx={sz/2} cy={sz/2} r={r} fill="none" stroke={co} strokeWidth="2" strokeLinecap="round" strokeDasharray={da+' '+ci}/></svg>
<span className="absolute inset-0 flex items-center justify-center font-mono text-[7px] font-bold text-white/80">{v}</span>
</div>)};
const SignalGrid=({signals,weights})=>(<div className="grid grid-cols-3 gap-2 mt-2">{Object.entries(signals).map(([k,v])=>(
<div key={k} className="flex items-center gap-1.5">
<MiniRing v={Math.round(v*100)}/>
<div className="min-w-0"><div className="text-[9px] text-white/70 capitalize truncate">{k}</div><div className="text-[8px] font-mono text-muted/50">{(weights[k]*100).toFixed(0)}% wt</div></div>
</div>))}</div>);
// ═══════════ SYSTEM HEALTH VIEW (§12.2 /api/status) ═══════════
const SystemView=()=>{
const scannerMetrics={scansTotal:1247,listingsProcessed:14964,matched:892,rejected:14072,dealsCreated:DEALS.length,avgCycleSec:14.2,lastScan:new Date(Date.now()-12000),interval:5};
const apiMetrics={ebay:{used:1847,limit:5000,search:288,getItem:1559,oauthValid:true,lastError:null},scrydex:{credits:47600,total:75000,lastSync:new Date(Date.now()-10*60000)},fx:{rate:0.789,lastFetch:new Date(Date.now()-47*60000),stale:false}};
const catalogMetrics={expansions:347,cards:18420,variants:52800,lastFull:new Date(Date.now()-48*3600000),lastDelta:new Date(Date.now()-10*60000)};
const alerts=[
  {sev:'warn',msg:'Exchange rate last fetched 47m ago — approaching staleness threshold (4h)',ts:new Date(Date.now()-47*60000)},
  {sev:'warn',msg:'eBay rate limit: 2 consecutive 429s detected this cycle',ts:new Date(Date.now()-8*60000)},
];
return(
<div className="flex-1 overflow-y-auto p-6 bg-obsidian">
<div className="max-w-5xl mx-auto space-y-6">
<div><h1 className="text-xl font-bold text-white mb-1">System Health</h1><p className="text-sm text-muted">Real-time status of all PokéSnipe services. Data from <span className="font-mono text-white/70">GET /api/status</span></p></div>

{/* Active alerts */}
{alerts.length>0&&<div className="space-y-2">{alerts.map((a,i)=>(
<div key={i} className={`flex items-start gap-3 p-3 rounded-xl border ${a.sev==='warn'?'bg-warn/5 border-warn/20':'bg-risk/5 border-risk/20'}`}>
<I.AlertTriangle s={16} c={`shrink-0 mt-0.5 ${a.sev==='warn'?'text-warn':'text-risk'}`}/>
<div className="flex-1"><p className={`text-sm ${a.sev==='warn'?'text-warn':'text-risk'}`}>{a.msg}</p><p className="text-[10px] text-muted mt-0.5">{timeAgo(a.ts)}</p></div>
</div>))}</div>}

{/* Scanner */}
<div className="bg-surface border border-border rounded-xl p-5">
<div className="flex items-center justify-between mb-4"><div className="flex items-center gap-2"><I.Radar s={18} c="text-brand"/><h2 className="text-sm font-bold text-white">Scanner</h2></div><div className="flex items-center gap-2 text-xs"><StatusDot ok={true}/><span className="text-profit font-semibold">Running</span><span className="text-muted">· every {scannerMetrics.interval}min · last {timeAgo(scannerMetrics.lastScan)}</span></div></div>
<div className="grid grid-cols-2 md:grid-cols-4 gap-3">
<MetricCard icon={I.Activity} label="Scans Total" value={scannerMetrics.scansTotal.toLocaleString()} sub={`${scannerMetrics.avgCycleSec}s avg cycle`}/>
<MetricCard icon={I.Search} label="Listings Processed" value={scannerMetrics.listingsProcessed.toLocaleString()} sub={`${scannerMetrics.matched} matched · ${scannerMetrics.rejected} rejected`}/>
<MetricCard icon={I.Zap} label="Deals Created" value={scannerMetrics.dealsCreated} color="text-profit"/>
<MetricCard icon={I.Check} label="Match Rate" value={`${((scannerMetrics.matched/scannerMetrics.listingsProcessed)*100).toFixed(1)}%`} sub="matched / processed"/>
</div></div>

{/* API Budgets */}
<div className="bg-surface border border-border rounded-xl p-5">
<div className="flex items-center gap-2 mb-4"><I.Globe s={18} c="text-brand"/><h2 className="text-sm font-bold text-white">API Budgets</h2></div>
<div className="grid grid-cols-1 md:grid-cols-3 gap-4">
<div className="bg-obsidian rounded-xl p-4 border border-border">
<div className="flex items-center justify-between mb-3"><span className="text-xs font-bold text-white">eBay Browse API</span><div className="flex items-center gap-1.5"><StatusDot ok={apiMetrics.ebay.oauthValid}/><span className="text-[10px] text-muted">OAuth valid</span></div></div>
<Progress value={apiMetrics.ebay.used} max={apiMetrics.ebay.limit} warn={80} label="Daily calls"/>
<div className="flex gap-4 mt-3 text-[10px] text-muted"><span>search <span className="text-white/70 font-mono">{apiMetrics.ebay.search}</span></span><span>getItem <span className="text-white/70 font-mono">{apiMetrics.ebay.getItem}</span></span></div>
</div>
<div className="bg-obsidian rounded-xl p-4 border border-border">
<div className="flex items-center justify-between mb-3"><span className="text-xs font-bold text-white">Scrydex</span><span className="text-[10px] text-muted">Last sync {timeAgo(apiMetrics.scrydex.lastSync)}</span></div>
<Progress value={apiMetrics.scrydex.total-apiMetrics.scrydex.credits} max={apiMetrics.scrydex.total} color="bg-brand" warn={80} label="Credits used"/>
<div className="text-[10px] text-muted mt-2"><span className="text-white/70 font-mono">{apiMetrics.scrydex.credits.toLocaleString()}</span> credits remaining</div>
</div>
<div className="bg-obsidian rounded-xl p-4 border border-border">
<div className="flex items-center justify-between mb-3"><span className="text-xs font-bold text-white">Exchange Rate</span><StatusDot ok={!apiMetrics.fx.stale}/></div>
<div className="text-3xl font-mono font-bold text-white mb-1">{apiMetrics.fx.rate}</div>
<div className="text-[10px] text-muted">USD → GBP · fetched {timeAgo(apiMetrics.fx.lastFetch)}</div>
<div className="text-[10px] text-muted mt-1">Staleness threshold: 4 hours</div>
</div></div></div>

{/* Card Catalog */}
<div className="bg-surface border border-border rounded-xl p-5">
<div className="flex items-center gap-2 mb-4"><I.Database s={18} c="text-brand"/><h2 className="text-sm font-bold text-white">Card Catalog</h2></div>
<div className="grid grid-cols-2 md:grid-cols-4 gap-3">
<MetricCard icon={I.Database} label="Expansions" value={catalogMetrics.expansions}/>
<MetricCard icon={I.Database} label="Cards" value={catalogMetrics.cards.toLocaleString()}/>
<MetricCard icon={I.Database} label="Variants" value={catalogMetrics.variants.toLocaleString()}/>
<MetricCard icon={I.Clock} label="Last Full Sync" value={timeAgo(catalogMetrics.lastFull)} sub={`Delta: ${timeAgo(catalogMetrics.lastDelta)}`}/>
</div>
<div className="mt-4 pt-3 border-t border-border/50"><h3 className="text-[10px] font-bold text-muted uppercase tracking-wider mb-2">Recent Syncs</h3>
<div className="space-y-1.5">{SYNC_LOG.map(s=>(
<div key={s.id} className="flex items-center gap-3 text-[11px] font-mono py-1.5 px-3 rounded-lg bg-obsidian">
<span className={`px-1.5 py-0.5 rounded text-[9px] font-bold ${s.type==='full'?'bg-brand/10 text-brand':'bg-surfaceHover text-muted'}`}>{s.type.toUpperCase()}</span>
<span className="text-muted">{fmtTime(s.startedAt)}</span>
<span className={`${s.status==='completed'?'text-profit':'text-risk'}`}>{s.status}</span>
<span className="text-muted/60">·</span><span className="text-white/70">{s.cards.toLocaleString()} cards</span>
<span className="text-muted/60">·</span><span className="text-white/70">{s.variants.toLocaleString()} variants</span>
<span className="text-muted/60">·</span><span className="text-muted">{s.credits} cr</span>
</div>))}</div></div></div>

{/* Background Jobs */}
<div className="bg-surface border border-border rounded-xl p-5">
<div className="flex items-center gap-2 mb-4"><I.Clock s={18} c="text-brand"/><h2 className="text-sm font-bold text-white">Background Jobs (§14.3)</h2></div>
<div className="space-y-2">
{[{name:'eBay Scan',interval:'5 min',last:'12s ago',ok:true},{name:'Deal Cleanup',interval:'1 hour',last:'18m ago',ok:true},{name:'Exchange Rate',interval:'1 hour',last:'47m ago',ok:true},{name:'Hot Refresh',interval:'Daily 03:00',last:'21h ago',ok:true},{name:'Expansion Check',interval:'Daily 04:00',last:'22h ago',ok:true},{name:'Full Sync',interval:'Weekly Sun 03:00',last:'2d ago',ok:true},{name:'Listings Pre-fetch',interval:'Weekly Sun 05:00',last:'2d ago',ok:true}].map(j=>(
<div key={j.name} className="flex items-center justify-between py-2 px-3 rounded-lg bg-obsidian text-sm">
<div className="flex items-center gap-3"><StatusDot ok={j.ok}/><span className="text-white font-medium">{j.name}</span></div>
<div className="flex items-center gap-4 text-[11px] font-mono"><span className="text-muted">{j.interval}</span><span className="text-white/60">{j.last}</span></div>
</div>))}
</div></div>

</div></div>)};

// ═══════════ AUDIT LOG VIEW (§12.1 structured logging) ═══════════
const AuditView=()=>{
const [filter,setFilter]=useState('all'); // all|info|warn|error
const [svcFilter,setSvcFilter]=useState('all');
const services=[...new Set(AUDIT_LOG.map(l=>l.service))];
const filtered=AUDIT_LOG.filter(l=>(filter==='all'||l.level===filter)&&(svcFilter==='all'||l.service===svcFilter));
const levelCfg={info:{bg:'bg-brand/10',text:'text-brand',dot:'bg-brand'},warn:{bg:'bg-warn/10',text:'text-warn',dot:'bg-warn'},error:{bg:'bg-risk/10',text:'text-risk',dot:'bg-risk'}};
return(
<div className="flex-1 overflow-y-auto p-6 bg-obsidian">
<div className="max-w-5xl mx-auto space-y-5">
<div><h1 className="text-xl font-bold text-white mb-1">Audit Log</h1><p className="text-sm text-muted">Pipeline trace for every listing processed. Powered by Pino structured logging (§12.1).</p></div>

{/* Filters */}
<div className="flex items-center gap-3 flex-wrap">
<div className="flex items-center gap-1 bg-surface border border-border rounded-lg p-1">
{['all','info','warn','error'].map(l=><button key={l} onClick={()=>setFilter(l)} className={`px-3 py-1.5 text-[10px] font-bold rounded tracking-wider transition-all ${filter===l?'bg-border text-white shadow-sm':'text-muted/50 hover:text-muted'}`}>{l.toUpperCase()}</button>)}
</div>
<div className="flex items-center gap-1 bg-surface border border-border rounded-lg p-1">
<button onClick={()=>setSvcFilter('all')} className={`px-3 py-1.5 text-[10px] font-bold rounded tracking-wider transition-all ${svcFilter==='all'?'bg-border text-white shadow-sm':'text-muted/50 hover:text-muted'}`}>ALL</button>
{services.map(s=><button key={s} onClick={()=>setSvcFilter(s)} className={`px-3 py-1.5 text-[10px] font-bold rounded tracking-wider transition-all ${svcFilter===s?'bg-border text-white shadow-sm':'text-muted/50 hover:text-muted'}`}>{s}</button>)}
</div>
<span className="text-[10px] text-muted ml-auto font-mono">{filtered.length} entries</span>
</div>

{/* Log entries */}
<div className="bg-surface border border-border rounded-xl overflow-hidden">
<div className="grid grid-cols-[80px_70px_90px_1fr] text-[9px] font-bold text-muted uppercase tracking-wider px-4 py-2.5 border-b border-border bg-surface">
<span>Time</span><span>Level</span><span>Service</span><span>Message</span>
</div>
<div className="divide-y divide-border/50 max-h-[calc(100vh-280px)] overflow-y-auto">
{filtered.map(l=>{const lc=levelCfg[l.level];return(
<div key={l.id} className="grid grid-cols-[80px_70px_90px_1fr] px-4 py-3 text-sm hover:bg-surfaceHover transition-colors items-start">
<span className="font-mono text-[11px] text-muted">{fmtTime(l.ts)}</span>
<span><span className={`text-[9px] font-bold px-1.5 py-0.5 rounded ${lc.bg} ${lc.text}`}>{l.level.toUpperCase()}</span></span>
<span className="font-mono text-[11px] text-white/60">{l.service}</span>
<div>
<span className="text-white text-[12px]">{l.msg}</span>
{l.ctx&&<div className="mt-1 font-mono text-[10px] text-muted bg-obsidian rounded px-2.5 py-1.5 inline-flex flex-wrap gap-x-3 gap-y-0.5">
{Object.entries(l.ctx).map(([k,v])=><span key={k}><span className="text-muted/60">{k}:</span> <span className="text-white/70">{typeof v==='number'?v.toFixed?.(2)??v:String(v)}</span></span>)}
</div>}
</div>
</div>)})}
</div>
</div>
</div></div>)};

// ═══════════ MANUAL LOOKUP VIEW (§10.3 POST /api/lookup) ═══════════
const LookupView=()=>{
const [url,setUrl]=useState('');
const [loading,setLoading]=useState(false);
const [result,setResult]=useState(null);
const [error,setError]=useState(null);
const doLookup=()=>{
  if(!url.trim())return;
  setLoading(true);setError(null);setResult(null);
  // Simulate API call to POST /api/lookup
  setTimeout(()=>{
    if(!url.includes('ebay')){setError('Invalid URL — must be an eBay listing (ebay.co.uk/itm/…)');setLoading(false);return}
    setResult({card:'Pikachu VMAX',set:'Vivid Voltage',num:'044/185',cond:'NM',condSrc:'conditionDescriptors',isGr:false,conf:0.87,confT:'high',tier:'FLIP',eP:12.50,ship:2.99,bp:0.96,tCost:16.45,mGBP:22.30,pGBP:5.85,pPct:35.6,liq:0.72,liqG:'medium',seller:'uk_pokemon_store',fb:2104,signals:{nameMatch:0.90,numberMatch:1.0,setMatch:0.85,imageMatch:0.82}});
    setLoading(false);
  },2200);
};
return(
<div className="flex-1 overflow-y-auto p-6 bg-obsidian">
<div className="max-w-2xl mx-auto space-y-6">
<div><h1 className="text-xl font-bold text-white mb-1">Manual Lookup</h1><p className="text-sm text-muted">Paste an eBay listing URL to run it through the full matching and pricing pipeline. Uses <span className="font-mono text-white/70">POST /api/lookup</span></p></div>

{/* URL Input */}
<div className="bg-surface border border-border rounded-xl p-5">
<label className="text-[10px] font-bold text-muted uppercase tracking-wider block mb-2">eBay Listing URL</label>
<div className="flex gap-2">
<input type="url" value={url} onChange={e=>setUrl(e.target.value)} onKeyDown={e=>e.key==='Enter'&&doLookup()} placeholder="https://www.ebay.co.uk/itm/…" className="flex-1 bg-obsidian border border-border rounded-lg px-4 py-3 text-sm font-mono text-white focus:outline-none focus:border-brand placeholder:text-muted/40"/>
<button onClick={doLookup} disabled={loading||!url.trim()} className="bg-brand hover:bg-brand/90 disabled:opacity-40 disabled:cursor-not-allowed text-white font-bold px-6 py-3 rounded-lg flex items-center gap-2 transition-all text-sm">
{loading?<I.Loader s={16} c="w-4 h-4"/>:<I.Send s={16} c="w-4 h-4"/>}{loading?'Evaluating…':'Evaluate'}
</button>
</div>
<p className="text-[10px] text-muted mt-2">Runs the listing through: title parsing → number extraction → candidate lookup → confidence scoring → pricing → tier classification</p>
</div>

{error&&<div className="bg-risk/5 border border-risk/20 rounded-xl p-4 flex items-start gap-3"><I.AlertTriangle s={16} c="text-risk shrink-0 mt-0.5"/><p className="text-sm text-risk">{error}</p></div>}

{/* Result */}
{result&&<div className="space-y-4">
<div className="bg-surface border border-border rounded-xl p-5">
<div className="flex items-center gap-3 mb-4"><Ring v={Math.round(result.conf*100)} tier={result.confT} sz={44}/><div><h2 className="text-lg font-bold text-white">{result.card}</h2><p className="text-sm text-muted font-mono">{result.set} · {result.num} · {result.cond}</p></div><div className="ml-auto"><Tier t={result.tier}/></div></div>

{/* Pricing */}
<div className="grid grid-cols-3 gap-3 mb-4">
<div className="bg-obsidian rounded-lg p-3 text-center"><div className="text-[9px] text-muted uppercase mb-1">Total Cost</div><div className="text-lg font-mono font-bold text-white">£{result.tCost.toFixed(2)}</div></div>
<div className="bg-obsidian rounded-lg p-3 text-center"><div className="text-[9px] text-muted uppercase mb-1">Market Value</div><div className="text-lg font-mono font-bold text-white">£{result.mGBP.toFixed(2)}</div></div>
<div className="bg-obsidian rounded-lg p-3 text-center"><div className="text-[9px] text-muted uppercase mb-1">Net Profit</div><div className="text-lg font-mono font-bold text-profit">+£{result.pGBP.toFixed(2)}</div><div className="text-[10px] font-mono text-profit/70">+{result.pPct.toFixed(1)}%</div></div>
</div>

{/* Cost breakdown */}
<div className="space-y-1.5 font-mono text-[11px] bg-obsidian rounded-lg p-3">
<div className="flex justify-between"><span className="text-muted">eBay Price</span><span className="text-white">£{result.eP.toFixed(2)}</span></div>
<div className="flex justify-between"><span className="text-muted">Shipping</span><span className="text-white">{result.ship>0?`£${result.ship.toFixed(2)}`:'Free'}</span></div>
<div className="flex justify-between"><span className="text-muted">Buyer Protection</span><span className="text-white">£{result.bp.toFixed(2)}</span></div>
</div>

{/* Match signals */}
<div className="mt-4 pt-4 border-t border-border/50">
<h3 className="text-[10px] font-bold text-muted uppercase tracking-wider mb-3">Match Signals</h3>
<div className="grid grid-cols-2 gap-2">
{Object.entries(result.signals).filter(([k])=>k!=='method').map(([k,v])=>(
<div key={k} className="flex items-center justify-between bg-obsidian rounded-lg px-3 py-2">
<span className="text-[11px] text-muted capitalize">{k.replace(/([A-Z])/g,' $1').trim()}</span>
<div className="flex items-center gap-2"><div className="w-16 h-1.5 bg-border rounded-full overflow-hidden"><div className={`h-1.5 rounded-full ${v>=0.8?'bg-profit':v>=0.6?'bg-warn':'bg-risk'}`} style={{width:`${v*100}%`}}/></div><span className="text-[10px] font-mono text-white/70 w-8 text-right">{(v*100).toFixed(0)}%</span></div>
</div>))}
</div>
<div className="flex items-center gap-2 mt-3 text-[10px] text-muted"><span>Method:</span><span className="font-mono text-white/70">{result.signals.method}</span><span className="mx-2 text-border">·</span><span>Seller:</span><span className="font-mono text-white/70">{result.seller} ({result.fb.toLocaleString()})</span><span className="mx-2 text-border">·</span><span>Liquidity:</span><span className={`font-mono font-bold ${result.liqG==='high'?'text-profit':result.liqG==='medium'?'text-warn':'text-risk'}`}>{result.liqG} ({Math.round(result.liq*100)}%)</span></div>
</div>
</div>
</div>}

</div></div>)};

// ═══════════ SETTINGS VIEW (§10.4 /api/settings, §14.1) ═══════════
const SettingsView=()=>{
const [scanInterval,setScanInterval]=useState(5);
const [profitThreshold,setProfitThreshold]=useState(15);
const [showKeys,setShowKeys]=useState({});
const [telegramTest,setTelegramTest]=useState(null); // null|'loading'|'ok'|'error'
const [saved,setSaved]=useState(false);
const doSave=()=>{setSaved(true);setTimeout(()=>setSaved(false),2000)};
const credentials=[
  {key:'EBAY_CLIENT_ID',label:'eBay Client ID',value:'PokeSni-PokeSn-PRD-a1b2c3d4e',masked:'PokeSn…d4e',valid:true,tested:new Date(Date.now()-2*3600000)},
  {key:'EBAY_CLIENT_SECRET',label:'eBay Client Secret',value:'PRD-a1b2c3d4e5f6g7h8',masked:'PRD-a1…7h8',valid:true,tested:new Date(Date.now()-2*3600000)},
  {key:'SCRYDEX_API_KEY',label:'Scrydex API Key',value:'sk_live_abc123def456',masked:'sk_liv…456',valid:true,tested:new Date(Date.now()-10*60000)},
  {key:'SCRYDEX_TEAM_ID',label:'Scrydex Team ID',value:'team_pokesnipe',masked:'team_…nipe',valid:true,tested:null},
  {key:'EXCHANGE_RATE_API_KEY',label:'Exchange Rate API Key',value:'er_live_xyz789',masked:'er_liv…789',valid:true,tested:new Date(Date.now()-47*60000)},
  {key:'TELEGRAM_BOT_TOKEN',label:'Telegram Bot Token',value:'7123456789:AAH...',masked:'7123…AAH',valid:true,tested:null},
  {key:'TELEGRAM_CHAT_ID',label:'Telegram Chat ID',value:'-1001234567890',masked:'-100…890',valid:true,tested:null},
];
return(
<div className="flex-1 overflow-y-auto p-6 bg-obsidian">
<div className="max-w-3xl mx-auto space-y-6">
<div className="flex items-center justify-between"><div><h1 className="text-xl font-bold text-white mb-1">Settings</h1><p className="text-sm text-muted">Scanner configuration, API credentials, and notification preferences.</p></div>
<button onClick={doSave} className={`px-5 py-2 rounded-lg font-bold text-sm transition-all ${saved?'bg-profit text-white':'bg-brand hover:bg-brand/90 text-white'}`}>{saved?<span className="flex items-center gap-1.5"><I.Check s={16}/>Saved</span>:'Save Changes'}</button>
</div>

{/* Scanner Config */}
<div className="bg-surface border border-border rounded-xl p-5">
<div className="flex items-center gap-2 mb-4"><I.Radar s={18} c="text-brand"/><h2 className="text-sm font-bold text-white">Scanner Configuration</h2></div>
<div className="grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<label className="text-[10px] font-bold text-muted uppercase tracking-wider block mb-2">Scan Interval (minutes)</label>
<div className="flex items-center gap-3"><input type="range" min={1} max={30} value={scanInterval} onChange={e=>setScanInterval(+e.target.value)} className="flex-1 accent-brand h-1.5"/><span className="font-mono text-white text-sm w-10 text-right">{scanInterval}m</span></div>
<p className="text-[10px] text-muted mt-1">Lower = more API calls. Adjusts automatically when budget runs low (§3.3)</p>
</div>
<div>
<label className="text-[10px] font-bold text-muted uppercase tracking-wider block mb-2">Minimum Profit Threshold (%)</label>
<div className="flex items-center gap-3"><input type="range" min={5} max={60} step={5} value={profitThreshold} onChange={e=>setProfitThreshold(+e.target.value)} className="flex-1 accent-brand h-1.5"/><span className="font-mono text-white text-sm w-10 text-right">{profitThreshold}%</span></div>
<p className="text-[10px] text-muted mt-1">Tightens to ≥25% when daily budget drops below 500 (§3.3)</p>
</div>
</div>
<div className="grid grid-cols-2 md:grid-cols-4 gap-3 mt-4 pt-4 border-t border-border/50">
<div><label className="text-[10px] font-bold text-muted uppercase tracking-wider block mb-1">Deal TTL</label><span className="font-mono text-sm text-white">72 hours</span></div>
<div><label className="text-[10px] font-bold text-muted uppercase tracking-wider block mb-1">Confidence Floor</label><span className="font-mono text-sm text-white">0.65</span></div>
<div><label className="text-[10px] font-bold text-muted uppercase tracking-wider block mb-1">Budget Reserve</label><span className="font-mono text-sm text-white">500 calls</span></div>
<div><label className="text-[10px] font-bold text-muted uppercase tracking-wider block mb-1">Max Enrichment</label><span className="font-mono text-sm text-white">50/cycle</span></div>
</div>
</div>

{/* API Credentials — §11.2 AES-256-GCM encrypted */}
<div className="bg-surface border border-border rounded-xl p-5">
<div className="flex items-center gap-2 mb-1"><I.Key s={18} c="text-brand"/><h2 className="text-sm font-bold text-white">API Credentials</h2></div>
<p className="text-[10px] text-muted mb-4">Encrypted at rest (AES-256-GCM). Keys are never exposed via the API — only status and masked previews.</p>
<div className="space-y-2">
{credentials.map(c=>(
<div key={c.key} className="flex items-center gap-3 bg-obsidian rounded-lg px-4 py-3 border border-border/50">
<div className="flex-1 min-w-0">
<div className="flex items-center gap-2"><span className="text-xs font-bold text-white">{c.label}</span>{c.valid&&<span className="text-[8px] text-profit bg-profit/10 px-1.5 py-0.5 rounded font-bold">VALID</span>}</div>
<span className="text-[11px] font-mono text-muted">{showKeys[c.key]?c.value:c.masked}</span>
</div>
<button onClick={()=>setShowKeys(p=>({...p,[c.key]:!p[c.key]}))} className="p-1.5 rounded-lg text-muted hover:text-white transition-colors" title={showKeys[c.key]?'Hide':'Reveal'}>
{showKeys[c.key]?<I.EyeOff s={14}/>:<I.Eye s={14}/>}
</button>
{c.tested&&<span className="text-[9px] text-muted shrink-0">tested {timeAgo(c.tested)}</span>}
</div>))}
</div></div>

{/* Telegram — §12.3 */}
<div className="bg-surface border border-border rounded-xl p-5">
<div className="flex items-center gap-2 mb-1"><I.Bell s={18} c="text-brand"/><h2 className="text-sm font-bold text-white">Telegram Notifications</h2></div>
<p className="text-[10px] text-muted mb-4">Deal alerts and system warnings via Telegram (§12.3).</p>
<div className="space-y-3">
<div className="grid grid-cols-1 md:grid-cols-2 gap-3">
{[{label:'GRAIL deals',desc:'Profit >40% + high liquidity',on:true},{label:'HIT deals',desc:'Profit 25–40%',on:true},{label:'System warnings',desc:'API budget, rate limits, staleness',on:true},{label:'Critical alerts',desc:'Sync failures, accuracy drops',on:true}].map(n=>(
<div key={n.label} className="flex items-center justify-between bg-obsidian rounded-lg px-4 py-3 border border-border/50">
<div><span className="text-xs font-bold text-white">{n.label}</span><p className="text-[10px] text-muted">{n.desc}</p></div>
<div className={`w-10 h-5 rounded-full p-0.5 cursor-pointer transition-colors ${n.on?'bg-profit':'bg-border'}`}><div className={`w-4 h-4 rounded-full bg-white shadow transition-transform ${n.on?'translate-x-5':''}`}/></div>
</div>))}
</div>
<button onClick={()=>{setTelegramTest('loading');setTimeout(()=>setTelegramTest('ok'),1500)}} disabled={telegramTest==='loading'} className="px-4 py-2 bg-surface border border-border rounded-lg text-sm text-muted hover:text-white hover:border-brand transition-all flex items-center gap-2">
{telegramTest==='loading'?<I.Loader s={14} c="w-3.5 h-3.5"/>:telegramTest==='ok'?<I.Check s={14} c="w-3.5 h-3.5 text-profit"/>:<I.Send s={14} c="w-3.5 h-3.5"/>}
{telegramTest==='loading'?'Sending…':telegramTest==='ok'?'Test sent ✓':'Send Test Message'}
</button>
</div></div>
</div></div>)};

// ═══════════ APP ═══════════
const App=()=>{
const [selId,setSelId]=useState(DEALS[0].id);
const [time,setTime]=useState(new Date().toLocaleTimeString());
const [imgFlip,setImgFlip]=useState({});
const [detailScr,setDetailScr]=useState(false);
const [activeView,setActiveView]=useState('opportunities');
const [tierFilter,setTierFilter]=useState({GRAIL:true,HIT:true,FLIP:true,SLEEP:false});
const [searchQ,setSearchQ]=useState('');
const [reviews,setReviews]=useState(()=>{const r={};DEALS.forEach(d=>{if(d.reviewedAs)r[d.id]=d.reviewedAs});return r});
const [costExpanded,setCostExpanded]=useState(false);
const [confFlipped,setConfFlipped]=useState(false);
const [liqFlipped,setLiqFlipped]=useState(false);
const listRef=useRef(null);

useEffect(()=>{const t=setInterval(()=>setTime(new Date().toLocaleTimeString()),1000);return()=>clearInterval(t)},[]);
const deal=useMemo(()=>{setDetailScr(false);setCostExpanded(false);setConfFlipped(false);setLiqFlipped(false);return DEALS.find(d=>d.id===selId)},[selId]);
const filtered=useMemo(()=>{let r=DEALS.filter(d=>tierFilter[d.tier]);if(searchQ.trim()){const q=searchQ.toLowerCase();r=r.filter(d=>d.name.toLowerCase().includes(q)||d.set.name.toLowerCase().includes(q)||d.num.includes(q))}return r},[tierFilter,searchQ]);
const grails=DEALS.filter(d=>d.tier==='GRAIL').length;
const hits=DEALS.filter(d=>d.tier==='HIT').length;
const handleListKey=useCallback((e)=>{if(!['ArrowDown','ArrowUp','Enter'].includes(e.key))return;e.preventDefault();const idx=filtered.findIndex(d=>d.id===selId);if(e.key==='ArrowDown'&&idx<filtered.length-1){setSelId(filtered[idx+1].id);listRef.current?.children[idx+1]?.scrollIntoView({block:'nearest'})}if(e.key==='ArrowUp'&&idx>0){setSelId(filtered[idx-1].id);listRef.current?.children[idx-1]?.scrollIntoView({block:'nearest'})}if(e.key==='Enter'&&deal)window.open(deal.url,'_blank')},[filtered,selId,deal]);
const isStale=(d)=>d.status==='expired'||d.status==='sold'||(Date.now()-d.at>60*60000);

return(
<div className="h-screen w-screen flex flex-col font-sans text-sm selection:bg-brand/30">
<header className="h-16 glass-panel flex items-center justify-between px-6 z-20 shrink-0">
<div className="flex items-center gap-8">
<div className="flex items-center gap-2"><div className="w-8 h-8 rounded-lg bg-gradient-to-br from-brand to-purple-600 flex items-center justify-center shadow-[0_0_15px_rgba(99,102,241,0.4)]"><I.Crosshair c="text-white w-5 h-5"/></div><span className="font-bold text-lg tracking-tight text-white">Pok&eacute;Snipe <span className="text-brand font-mono text-xs ml-1 bg-brand/10 px-1.5 py-0.5 rounded">PRO</span></span></div>
<div className="hidden lg:flex items-center h-8 ml-8"><Stat label="Today" value={DEALS.length}/><Stat label="Grails" value={grails}/><Stat label="Hits" value={hits}/><Stat label="Accuracy" value="91.2%"/></div>
</div>
<div className="flex items-center gap-4">
<div className="flex items-center gap-2 px-3 py-1.5 rounded-full bg-profit/10 text-profit border border-profit/20"><div className="w-2 h-2 rounded-full bg-profit pulse-dot"/><span className="text-xs font-bold tracking-wide">SCANNING</span></div>
<div className="text-xs font-mono text-muted">{time}</div>
<div className="w-px h-6 bg-border mx-2"/>
<button className="w-8 h-8 rounded-full bg-surface border border-border flex items-center justify-center hover:bg-surfaceHover transition-colors"><I.Bell c="text-muted w-4 h-4"/></button>
</div></header>

<div className="flex flex-1 overflow-hidden">
<aside className="w-64 glass-panel border-r border-border flex flex-col justify-between py-6 z-10 shrink-0">
<div className="px-3 space-y-1">
<SideItem icon={I.Radar} label="Opportunities" active={activeView==='opportunities'} badge={filtered.length} onClick={()=>setActiveView('opportunities')}/>
<SideItem icon={I.Server} label="System" active={activeView==='system'} onClick={()=>setActiveView('system')}/>
<SideItem icon={I.ScrollText} label="Audit Log" active={activeView==='audit'} onClick={()=>setActiveView('audit')}/>
<SideItem icon={I.FileSearch} label="Manual Lookup" active={activeView==='lookup'} onClick={()=>setActiveView('lookup')}/>
<SideItem icon={I.Settings} label="Settings" active={activeView==='settings'} onClick={()=>setActiveView('settings')}/>
</div>
<div className="px-6 mb-4"><div className="bg-surface rounded-xl p-4 border border-border relative overflow-hidden"><div className="absolute top-0 right-0 w-16 h-16 bg-brand opacity-10 rounded-bl-full"/><p className="text-[9px] text-muted mb-2 font-bold uppercase tracking-wider">eBay API Budget</p><div className="flex justify-between items-end mb-2"><span className="text-xl font-mono font-bold text-white">1,847</span><span className="text-[10px] font-mono text-muted">/ 5,000</span></div><div className="w-full bg-obsidian rounded-full h-1.5 mb-2 overflow-hidden"><div className="bg-profit h-1.5 rounded-full" style={{width:'37%'}}/></div><p className="text-[10px] text-muted">288 search &middot; 1,559 getItem</p></div></div>
</aside>

{activeView==='system'&&<SystemView/>}
{activeView==='audit'&&<AuditView/>}
{activeView==='lookup'&&<LookupView/>}
{activeView==='settings'&&<SettingsView/>}

{activeView==='opportunities'&&<main className="flex-1 flex overflow-hidden">
<div className="w-full lg:w-[55%] xl:w-[60%] flex flex-col bg-obsidian border-r border-border relative z-0">
<div className="p-4 border-b border-border bg-surface/50 backdrop-blur flex items-center justify-between shrink-0">
<div className="flex items-center gap-1 bg-surface border border-border rounded-lg p-1">
{['GRAIL','HIT','FLIP','SLEEP'].map(t=><button key={t} onClick={()=>setTierFilter(p=>({...p,[t]:!p[t]}))} className={'px-3 py-1.5 text-[10px] font-bold rounded tracking-wider transition-all '+(tierFilter[t]?'bg-border text-white shadow-sm':'text-muted/40 hover:text-muted')}>{t}</button>)}
</div>
<div className="flex items-center gap-3"><div className="relative"><I.Search c="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted"/><input type="text" value={searchQ} onChange={e=>setSearchQ(e.target.value)} placeholder="Search cards, sets..." className="bg-surface border border-border rounded-lg pl-9 pr-4 py-1.5 text-xs font-mono text-white focus:outline-none focus:border-brand placeholder:text-muted/50 w-56"/></div></div>
</div>
{filtered.length===0?<EmptyFeed hasFilter={searchQ||Object.values(tierFilter).some(v=>!v)}/>:
<div className="flex-1 overflow-y-auto p-2 space-y-1 relative" ref={listRef} onKeyDown={handleListKey} tabIndex={0} role="listbox" aria-label="Deal feed">
{filtered.map((d)=>{const t7=trendInfo(d.trends['7d']);const stale=isStale(d);const reviewed=reviews[d.id];const exp=EXPANSIONS[d.set.code];return(
<div key={d.id} role="option" aria-selected={selId===d.id} tabIndex={-1} onClick={()=>setSelId(d.id)}
  className={'deal-row group flex items-center gap-3 p-3 rounded-xl cursor-pointer transition-all border '+(selId===d.id?'bg-surface border-brand/50 shadow-[0_0_20px_rgba(99,102,241,0.05)]':'bg-surface/30 border-transparent hover:bg-surface hover:border-border')+' '+(d.tier==='GRAIL'&&!stale?'border-l-[3px] border-l-grail bg-gradient-to-r from-grail/[.03] to-transparent':'')+' '+(stale?'deal-stale':'')}>
{/* Thumbnail with expansion symbol overlay */}
<div className="w-14 h-[78px] rounded-md bg-obsidian overflow-hidden shrink-0 border border-white/5 shadow-md relative" onClick={(e)=>{if(hasEbImg(d)){e.stopPropagation();setImgFlip(p=>({...p,[d.id]:!p[d.id]}))}}} style={{cursor:hasEbImg(d)?'pointer':'default'}}>
<img src={bestImg(d,imgFlip[d.id])} alt={d.name} className="h-full w-full object-cover opacity-90 group-hover:opacity-100 transition-opacity" onError={(e)=>{e.target.src=d.scrImg}}/>
{hasEbImg(d)&&<div className={'absolute bottom-0.5 left-0.5 text-[7px] font-mono font-bold px-1 rounded '+(imgFlip[d.id]?'bg-brand/80 text-white':'bg-white/70 text-obsidian')}>{imgFlip[d.id]?'SCR':'eBay'}</div>}
{exp&&<img src={exp.symbol} alt="" className="absolute top-0.5 right-0.5 w-3.5 h-3.5 opacity-60" onError={(e)=>{e.target.style.display='none'}}/>}
</div>
<Ring v={Math.round(d.conf*100)} tier={d.confT}/>
<div className="flex-1 min-w-0 flex flex-col gap-0.5">
<div className="flex items-center gap-2"><Tier t={d.tier}/><span className="font-bold text-white text-sm truncate">{d.name}</span>{reviewed&&<span className={'text-[8px] font-bold px-1 rounded '+(reviewed==='correct'?'bg-profit/10 text-profit':'bg-risk/10 text-risk')}>{reviewed==='correct'?'\u2713':'\u2717'}</span>}</div>
<div className="flex items-center gap-1.5 text-[11px] text-muted truncate">
{exp&&<img src={exp.symbol} alt="" className="w-3 h-3 opacity-50 shrink-0" onError={(e)=>{e.target.style.display='none'}}/>}
<span>{d.set.name}</span><span className="text-border">&middot;</span><span className="font-mono text-[10px]">{d.num}</span>
{d.isGr&&<><span className="text-border">&middot;</span><span className="text-info font-semibold">{d.grader} {d.grade}</span></>}
<span className="text-border">&middot;</span><span className="text-[10px] font-semibold text-white/70">{d.cond}</span>
</div>
<div className="flex items-center gap-2">
<span className={'text-[9px] font-medium '+t7.c}>{t7.t}</span>
<span className="text-[9px] text-muted/40 ml-auto shrink-0" title={fmtListedTime(d.at)}>{timeAgo(d.at)}</span>
</div>
</div>
{/* Pricing column: profit hero + cost/market underneath */}
<div className="flex flex-col items-end shrink-0 pl-3 min-w-[86px]">
<span className={'text-lg font-bold font-mono leading-none '+(d.pGBP>=0?'text-profit':'text-risk')}>{d.pGBP>=0?'+':''}&#163;{d.pGBP.toFixed(2)}</span>
<span className={'text-[10px] font-mono mt-0.5 '+(d.pGBP>=0?'text-profit/60':'text-risk/60')}>{d.pPct>=0?'+':''}{d.pPct.toFixed(0)}% ROI</span>
<div className="text-[9px] font-mono text-muted/40 mt-1">&#163;{d.tCost.toFixed(0)} &rarr; &#163;{d.mGBP.toFixed(0)}</div>
</div>
</div>)})}
<div className="sticky bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-obsidian to-transparent pointer-events-none"/>
</div>}
</div>

{/* RIGHT: Deal Detail */}
{deal&&(()=>{const exp=EXPANSIONS[deal.set.code];const rv=reviews[deal.id];return(
<div className="hidden lg:flex w-[45%] xl:w-[40%] bg-surface flex-col shadow-[-20px_0_40px_rgba(0,0,0,.3)] z-10">
<div className="p-6 border-b border-border flex gap-6 items-start shrink-0 relative overflow-hidden">
<div className="absolute top-0 right-0 w-64 h-64 bg-brand rounded-full blur-[100px] opacity-10 pointer-events-none"/>
<div className="w-28 h-40 rounded-xl overflow-hidden shadow-2xl shrink-0 border border-white/10 bg-obsidian relative image-glow" onClick={()=>{if(hasEbImg(deal))setDetailScr(p=>!p)}} style={{cursor:hasEbImg(deal)?'pointer':'default'}}>
<img src={bestImg(deal,detailScr)} alt={deal.name} className="w-full h-full object-cover" onError={(e)=>{e.target.src=deal.scrImg}}/>
<div className="absolute inset-0 bg-gradient-to-tr from-transparent via-white/10 to-transparent opacity-50 mix-blend-overlay"/>
{hasEbImg(deal)&&<div className={'absolute bottom-1 left-1 text-[8px] font-mono font-bold px-1.5 py-0.5 rounded '+(detailScr?'bg-brand/90 text-white':'bg-white/80 text-obsidian')}>{detailScr?'Scrydex':'eBay'}</div>}
</div>
<div className="flex-1 pt-2">
<div className="flex flex-wrap gap-2 mb-3"><Tier t={deal.tier}/><span className="text-[10px] font-mono text-muted bg-surfaceHover px-2 py-0.5 rounded border border-border">{deal.cond}{deal.isGr?' \u00b7 '+deal.grader+' '+deal.grade:''}</span></div>
<h2 className="text-2xl font-bold text-white leading-tight mb-1">{deal.name}</h2>
<p className="text-sm text-muted font-mono mb-3">{deal.num} &middot; {deal.variant} &middot; {deal.rarity}</p>
{/* Expansion info with logo */}
{exp&&<div className="flex items-center gap-2 mb-3 bg-obsidian rounded-lg px-3 py-2 border border-border/50">
<img src={exp.logo} alt={exp.name} className="h-5 object-contain opacity-80" onError={(e)=>{e.target.style.display='none'}}/>
<div className="flex-1 min-w-0">
<div className="text-[10px] font-bold text-white truncate">{exp.name}</div>
<div className="text-[9px] text-muted font-mono">{exp.series} &middot; {exp.printedTotal}/{exp.total} cards &middot; {exp.releaseDate}</div>
</div>
</div>}
<div className="flex items-center gap-4 text-sm">
<div className="flex items-center gap-1.5 text-muted"><I.User s={16} c="w-4 h-4"/>{deal.seller} <span className="text-white">({deal.fb.toLocaleString()})</span></div>
<div className="flex items-center gap-1.5 text-muted"><I.Clock s={16} c="w-4 h-4"/><span title={fmtListedTime(deal.at)}>{timeAgo(deal.at)}</span></div>
</div></div></div>

<div className="flex-1 overflow-y-auto p-6 space-y-5">
{/* Profit hero */}
<div className="text-center py-3">
<span className={'text-4xl font-mono font-bold '+(deal.pGBP>=0?'text-profit':'text-risk')}>{deal.pGBP>=0?'+':''}&#163;{deal.pGBP.toFixed(2)}</span>
<div className={'text-sm font-mono mt-1 '+(deal.pGBP>=0?'text-profit/70':'text-risk/70')}>{deal.pPct>=0?'+':''}{deal.pPct.toFixed(1)}% return on &#163;{deal.tCost.toFixed(2)} cost</div>
</div>

{/* Collapsible pricing */}
<div className="bg-obsidian border border-border rounded-xl relative overflow-hidden">
<div className="absolute left-0 top-0 bottom-0 w-1 bg-brand"/>
<button onClick={()=>setCostExpanded(p=>!p)} className="w-full flex items-center justify-between p-4 text-left hover:bg-white/[.02] transition-colors">
<div className="flex items-center gap-6 font-mono text-sm">
<div><span className="text-[9px] font-sans text-muted uppercase tracking-wider block mb-0.5">Cost</span><span className="text-white font-bold">&#163;{deal.tCost.toFixed(2)}</span></div>
<span className="text-muted/40">&rarr;</span>
<div><span className="text-[9px] font-sans text-muted uppercase tracking-wider block mb-0.5">Market</span><span className="text-white font-bold">&#163;{deal.mGBP.toFixed(2)}</span></div>
<span className="text-muted/40">=</span>
<div><span className="text-[9px] font-sans text-muted uppercase tracking-wider block mb-0.5">Profit</span><span className="text-profit font-bold">+&#163;{deal.pGBP.toFixed(2)}</span></div>
</div>
<I.ChevronDown s={16} c={'text-muted transition-transform '+(costExpanded?'rotate-180':'')}/>
</button>
{costExpanded&&<div className="px-5 pb-4 space-y-2 font-mono text-sm border-t border-border/50 pt-3">
<div className="flex justify-between text-white"><span className="text-muted font-sans text-xs">eBay Listing</span><span>&#163;{deal.eP.toFixed(2)}</span></div>
<div className="flex justify-between text-white"><span className="text-muted font-sans text-xs">Shipping</span><span>{deal.ship>0?'\u00a3'+deal.ship.toFixed(2):'Free'}</span></div>
<div className="flex justify-between text-white"><span className="text-muted font-sans text-xs">Buyer Protection</span><span>&#163;{deal.bp.toFixed(2)}</span></div>
<div className="w-full h-px bg-border/50"/>
<div className="flex justify-between text-[10px] text-muted"><span className="font-sans">FX Rate</span><span>USD/GBP {deal.fx.toFixed(4)}</span></div>
</div>}
</div>

{/* Confidence + Liquidity side by side */}
<div className="grid grid-cols-2 gap-3">
<div className="bg-obsidian border border-border rounded-xl p-4 cursor-pointer transition-all hover:border-border/80" onClick={()=>setConfFlipped(p=>!p)}>
{!confFlipped ? <>
<div className="flex items-center justify-between mb-3"><span className="text-[9px] font-bold text-muted uppercase tracking-wider">Confidence</span><span className="text-[8px] text-muted/40">tap</span></div>
<div className="flex items-center gap-3"><Ring v={Math.round(deal.conf*100)} tier={deal.confT} sz={44}/><div><div className="text-xl font-mono font-bold text-white">{Math.round(deal.conf*100)}%</div><div className="text-[10px] text-muted capitalize">{deal.confT}</div></div></div>
</> : <>
<div className="flex items-center justify-between mb-1"><span className="text-[9px] font-bold text-muted uppercase tracking-wider">Signals</span><span className="text-[8px] font-mono text-muted/50">geo. mean</span></div>
<SignalGrid signals={deal.confSignals} weights={CONF_WEIGHTS}/>
</>}
</div>
<div className="bg-obsidian border border-border rounded-xl p-4 cursor-pointer transition-all hover:border-border/80" onClick={()=>setLiqFlipped(p=>!p)}>
{!liqFlipped ? <>
<div className="flex items-center justify-between mb-3"><span className="text-[9px] font-bold text-muted uppercase tracking-wider">Liquidity</span><span className="text-[8px] text-muted/40">tap</span></div>
<div className="flex items-center gap-3"><Ring v={Math.round(deal.liq*100)} tier={deal.liqG==='high'?'high':deal.liqG==='medium'?'medium':'low'} sz={44}/><div><div className="text-xl font-mono font-bold text-white">{Math.round(deal.liq*100)}%</div><div className="text-[10px] text-muted capitalize">{deal.liqG}</div></div></div>
</> : <>
<div className="flex items-center justify-between mb-1"><span className="text-[9px] font-bold text-muted uppercase tracking-wider">Signals</span><span className="text-[8px] font-mono text-muted/50">arith. mean</span></div>
{(()=>{const w=deal.hasVelocity?LIQ_WEIGHTS_V:LIQ_WEIGHTS_NV;return <SignalGrid signals={deal.liqSignals} weights={w}/>})()}
</>}
</div>
</div>

{/* Condition Comps (reverted to original grid) */}
<div className="bg-obsidian border border-border rounded-xl p-5">
<h3 className="text-[10px] font-bold text-muted uppercase tracking-wider mb-3">Condition Comps (Scrydex)</h3>
<div className="grid grid-cols-4 gap-2">
{['NM','LP','MP','HP'].map(c=>{const cp=deal.comps[c],ac=deal.cond===c;return(
<div key={c} className={'rounded-lg p-3 text-center border '+(ac?'bg-brand/10 border-brand/30':'bg-surface border-border')}>
<div className={'text-[10px] font-bold mb-1 '+(ac?'text-brand':'text-muted')}>{c}</div>
{cp?<><div className="text-sm font-mono font-bold text-white">&#163;{cp.mk.toFixed(0)}</div><div className="text-[9px] font-mono text-muted">low &#163;{cp.lo.toFixed(0)}</div></>:<div className="text-[10px] text-muted/50">&mdash;</div>}
</div>)})}
</div></div>

{/* Price Trend (reverted to original grid) */}
<div className="bg-obsidian border border-border rounded-xl p-5">
<h3 className="text-[10px] font-bold text-muted uppercase tracking-wider mb-3">Price Trend</h3>
<div className="grid grid-cols-4 gap-2">
{['1d','7d','30d','90d'].map(w=>{const v=deal.trends[w],ti=trendInfo(v);return(
<div key={w} className="bg-surface rounded-lg p-3 text-center"><div className="text-[10px] font-bold text-muted uppercase mb-1">{w}</div><div className={'text-sm font-mono font-bold '+ti.c}>{v>0?'+':''}{v.toFixed(1)}%</div></div>)})}
</div></div>

{/* Match Review */}
<div className={'bg-obsidian border rounded-xl p-4 flex items-center justify-between '+(rv==='correct'?'border-profit/30':rv==='incorrect'?'border-risk/30':'border-border')}>
<div><div className="text-[10px] font-bold text-muted uppercase tracking-wider">Match Review</div>
{rv?<div className={'text-[11px] mt-1 font-semibold '+(rv==='correct'?'text-profit':'text-risk')}>Marked as {rv}</div>:<div className="text-[11px] text-muted mt-1">Was this card match correct?</div>}</div>
<div className="flex gap-2">
<button onClick={()=>setReviews(p=>({...p,[deal.id]:p[deal.id]==='correct'?null:'correct'}))} className={'p-2 rounded-lg border transition-all '+(rv==='correct'?'bg-profit/20 border-profit/40 text-profit':'border-border bg-surface hover:bg-profit/10 hover:border-profit/30 hover:text-profit text-muted')} title="Correct match">{rv==='correct'?<I.Check s={16} c="w-4 h-4"/>:<I.Up s={16} c="w-4 h-4"/>}</button>
<button onClick={()=>setReviews(p=>({...p,[deal.id]:p[deal.id]==='incorrect'?null:'incorrect'}))} className={'p-2 rounded-lg border transition-all '+(rv==='incorrect'?'bg-risk/20 border-risk/40 text-risk':'border-border bg-surface hover:bg-risk/10 hover:border-risk/30 hover:text-risk text-muted')} title="Incorrect match">{rv==='incorrect'?<I.X s={16} c="w-4 h-4"/>:<I.Down s={16} c="w-4 h-4"/>}</button>
</div></div>
</div>

{/* CTA */}
<div className="p-6 border-t border-border bg-surface shrink-0">
{isStale(deal)&&<div className="text-center text-[10px] text-warn bg-warn/10 border border-warn/20 rounded-lg py-1.5 mb-3">This listing may no longer be available</div>}
<a href={deal.url} target="_blank" rel="noopener noreferrer" className="w-full bg-brand hover:bg-brand/90 text-white font-bold py-3.5 px-4 rounded-xl flex items-center justify-center gap-2 transition-all shadow-[0_0_20px_rgba(99,102,241,0.3)] hover:shadow-[0_0_25px_rgba(99,102,241,0.5)] hover:-translate-y-0.5"><I.ExtLink c="w-5 h-5"/>SNAG ON EBAY &rarr;</a>
<div className="text-center text-[10px] text-muted mt-2">{deal.seller} &middot; {deal.fb.toLocaleString()} feedback &middot; Enter &#8629; to open</div>
</div>
</div>)})()}
</main>}

</div>

<footer className="h-10 border-t border-border bg-surface/80 flex items-center px-4 text-[10px] font-mono shrink-0 gap-6">
<div className="flex items-center gap-2"><div className="w-2 h-2 rounded-full bg-profit pulse-dot"/><span className="font-semibold text-white/80">Scanning</span><span className="text-muted">12s ago</span></div>
<div className="border-l border-border h-5"/><div className="flex items-center gap-1.5"><span className="text-muted">Deals</span><span className="text-white font-semibold">{filtered.length}/{DEALS.length}</span></div>
<div className="border-l border-border h-5"/><div className="flex items-center gap-1.5"><span className="text-muted">Accuracy</span><span className="text-white font-semibold">91.2%</span></div>
<div className="flex-1"/>
<div className="flex items-center gap-4 text-muted"><span>eBay <span className="text-white/70">1,847/5k</span></span><span>Scrydex <span className="text-white/70">47.6k cr</span></span><span>FX <span className="text-white/70">0.789</span></span></div>
</footer>
</div>)};

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>